#!/bin/sh
set -e

source $(dirname $0)/version

BUILD_DEBUG="${BUILD_DEBUG:-}"
if [[ -n "${BUILD_DEBUG}" ]]; then
    set -x
    env
fi

cd $(dirname $0)

echo "Cleaning up..."
rm -rf node_modules .nuxt dist

echo "Bootstrapping..."
yarn --pure-lockfile install

echo "Building..."
ROUTER_BASE="/dashboard" RESOURCE_BASE="https://releases.rancher.com/dashboard/${VERSION}" run build --devtools --spa
